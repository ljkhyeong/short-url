<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Short URL Service</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .card { width: 100%; max-width: 500px; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .result-box { display: none; background: #e9ecef; padding: 15px; border-radius: 5px; margin-top: 20px; text-align: center; }
        .short-url-link { font-weight: bold; color: #0d6efd; font-size: 1.2rem; text-decoration: none; }
    </style>
</head>
<body>

<div class="card">
    <h3 class="text-center mb-4">ğŸ”— URL Shortener</h3>

    <div class="mb-3">
        <label for="originalUrl" class="form-label">ì¤„ì´ê³  ì‹¶ì€ ê¸´ URLì„ ì…ë ¥í•˜ì„¸ìš”</label>
        <input type="url" class="form-control" id="originalUrl" placeholder="https://example.com/very/long/url..." required>
        <div id="errorMsg" class="text-danger mt-1" style="font-size: 0.9rem;"></div>
    </div>

    <button onclick="generateShortUrl()" class="btn btn-primary w-100 btn-lg">Shorten URL</button>

    <div id="resultBox" class="result-box">
        <p class="mb-2 text-muted">Your short link is ready!</p>
        <a id="shortUrlAnchor" href="#" target="_blank" class="short-url-link"></a>
        <button onclick="copyToClipboard()" class="btn btn-outline-secondary btn-sm mt-3 d-block mx-auto">ğŸ“‹ Copy to Clipboard</button>
    </div>
</div>

<script>
    async function generateShortUrl() {
        const urlInput = document.getElementById('originalUrl')
        const errorMsg = document.getElementById('errorMsg')
        const resultBox = document.getElementById('resultBox')
        const shortUrlAnchor = document.getElementById('shortUrlAnchor');

        errorMsg.innerText = ''
        resultBox.style.display = 'none'

        if (!urlInput.value) {
            errorMsg.innerText = 'URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”'
            return
        }

        try {
            const response = await fetch('/api/v1/short-links', {
                method: 'POST',
                headers: { 'Content-Type' : 'application/json'},
                body: JSON.stringify({ url: urlInput.value })
            })

            if (!response.ok) {
                const errData = await response.json()
                throw new Error(errData.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤')
            }

            const data = await response.json()

            const fullShortUrl = window.location.origin + '/' + data.shortKey

            shortUrlAnchor.href = fullShortUrl
            shortUrlAnchor.innerText = fullShortUrl
            resultBox.style.display = 'block'

        } catch (error) {
            errorMsg.innerText = error.message
        }
    }

    function copyToClipboard() {
        const shortUrl = document.getElementById('shortUrlAnchor').href
        navigator.clipboard.writeText(shortUrl).then(() => {
            alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!")
        })
    }
</script>

</body>
</html>